<div id="player"></div>

<script>
    // 1. Cargar la API de forma asíncrona
    var tag = document.createElement('script');
    tag.src = "https://www.youtube.com/iframe_api";
    var firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

    const urlParams = new URLSearchParams(window.location.search);
    const vID = urlParams.get('v');

    // 2. Esta función se ejecuta cuando la API está lista
    var player;
    function onYouTubeIframeAPIReady() {
        player = new YT.Player('player', {
            height: '100%',
            width: '100%',
            videoId: vID,
            host: 'https://www.youtube-nocookie.com', // Uso de dominio seguro
            playerVars: {
                'autoplay': 1,
                'rel': 0,
                'origin': window.location.origin, // Crucial para validación
                'enablejsapi': 1
            },
            events: {
                'onReady': (event) => event.target.playVideo()
            }
        });
    }
</script>
